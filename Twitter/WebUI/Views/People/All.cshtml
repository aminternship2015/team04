@model Models.ViewModels.AllViewModel

@{
    var currentUserId = ((Models.UserViewModel)HttpContext.Current.Session["CurrentUser"]).Id;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>All</title>
    @*<script src="@Url.Content("~/Content/JavaScripts.js")"></script>*@
    <script>
        $(document).ready(function () {
            //$('.unfoll').hide();

            $('.foll').click(function (e) {
                var clickedButton = $(e.target);
                var parentBlock = clickedButton.parents('.users-table');
                var tweetId = $(this).parents('.users-table').attr('id');

                $.get('/People/Follow', { 'publisherId': tweetId, 'subsriberId': 0 });
                $(this).hide();
                $(parentBlock).find('.unfoll').css('background', '#E74C3C');
                $(parentBlock).find('.unfoll').show();
            });

            $('.unfoll').click(function (e) {
                var clickedButton = $(e.target);
                var parentBlock = clickedButton.parents('.users-table');
                var tweetId = $(this).parents('.users-table').attr('id');

                $(parentBlock).find('.foll').show();
                $(this).hide();
                $.get('/People/Unfollow', { 'id': tweetId });
            });

            //$('.foll').click(function (e) {
            //    var clickedButton = $(e.target);
            //    var parentBlock = clickedButton.parents('.users-table');
            //    var tweetId = $(this).parents('.users-table').attr('id');
               
            //    if ($(parentBlock).find('.foll').text() == 'Follow') {
            //        $.get('/People/Follow', { 'publisherId': tweetId, 'subsriberId': 0 }, function () {
            //            $(parentBlock).find('.foll').text('Unfollow');
            //            $(parentBlock).find('.foll').css('background', '#E74C3C');
            //        });
            //        }
            //    else {
            //        $.get('/People/Unfollow', { 'id': tweetId }, function () {
            //            $(parentBlock).find('.foll').text('Follow');
            //            $(parentBlock).find('.foll').css('background', '#3498db');
            //        });
                        
            //        }
      
            //});

        });
    </script>
</head>
<body>
    <div id="all-users">
        <h2>All Users</h2>
        <span class="badge">Total users: @Model.Users.Count</span>
        <table class="table table-striped table-hover ">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Fullname</th>
                    <th>Username</th>
                    <th>E-mail</th>
                </tr>
            </thead>
            <tbody>

                @foreach (var user in Model.Users)
                {

                    <tr class="users-table" id="@user.Id">
                        <td>@(Model.Users.IndexOf(user) + 1)</td>
                        <td>
                            @Html.ActionLink(@user.FullName, "Info", "People", new { @user.Id }, null)
                        </td>
                        <td>
                            @user.Username
                        </td>
                        <td>
                            @user.Email
                        </td>
                        <td width="12%">
                            @{
                    var currentFollowId = Model.CurrentUserFollows.FirstOrDefault(h => h.SubId == currentUserId && h.PubId == user.Id); 
                            }
                            @if (currentFollowId != null)
                            {
                                <span class="btn unfoll" onClick="window.location.href=window.location.href">Unfollow</span>
                            
                            }
                            else
                            {
                                <span class="btn foll" onClick="window.location.href=window.location.href">Follow</span>
                            }
                            @*<span class="btn foll">follow</span>
                             <span class="btn foll">unfollow</span>*@
                        </td>
                    </tr>

                }
            </tbody>
        </table>
    </div>
</body>
</html>
