@model Models.ViewModels.AllViewModel

@{
    var currentUserId = ((Models.UserViewModel)HttpContext.Current.Session["CurrentUser"]).Id;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>All</title>
    @*<script src="@Url.Content("~/Content/JavaScripts.js")"></script>*@
    <script>
        $(document).ready(function () {

            $('.foll').click(function (e) {
                var clickedButton = $(e.target);
                var parentBlock = clickedButton.parents('.users-table');
                var tweetId = $(this).parents('.users-table').attr('id');

                $.get('/People/Follow', { 'publisherId': tweetId, 'subsriberId': 0 });
                $(this).hide();
                $(parentBlock).find('.unfoll').css('background', '#ff6a00');
                $(parentBlock).find('.unfoll').show();
            });

            $('.unfoll').click(function (e) {
                var clickedButton = $(e.target);
                var parentBlock = clickedButton.parents('.users-table');
                var tweetId = $(this).parents('.users-table').attr('id');

                $.get('/People/Unfollow', { 'id': tweetId });
                $(parentBlock).find('.foll').show();
                $(this).hide();

            });

            $('.unfoll').hover(function () {
                $(this).css("background-color", '#E74C3C');
            }, function () {
                $(this).css("background-color", '#ff6a00');
            });

        });
    </script>
</head>
<body>
    <div id="all-users">
        <h2>All Users</h2>
        <span class="badge">Total users: @Model.Users.Count</span>
        <table class="table table-striped table-hover ">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Fullname</th>
                    <th>Username</th>
                    <th>E-mail</th>
                </tr>
            </thead>
            <tbody>

                @foreach (var user in Model.Users)
                {

                    <tr class="users-table" id="@user.Id">
                        <td>@(Model.Users.IndexOf(user) + 1)</td>
                        <td>
                            @Html.ActionLink(@user.FullName, "Info", "People", new { @user.Id }, null)
                        </td>
                        <td>
                            @user.Username
                        </td>
                        <td>
                            @user.Email
                        </td>
                        <td width="12%">
                            @{
                    var currentFollowId = Model.CurrentUserFollows.FirstOrDefault(h => h.SubId == currentUserId && h.PubId == user.Id); 
                            }
                            @if (currentFollowId != null)
                            {
                                <span class="btn unfoll" style="display:block; width: 100%;" >Unfollow</span> 
                                <span class="btn foll" style="display:none; width: 100%;">Follow</span>
                            
                            }
                            else
                            {
                                <span class="btn unfoll" style="display:none; width: 100%;">Unfollow</span> 
                                <span class="btn foll" style="display:block; width: 100%;">Follow</span>
                            }
                            @*<span class="btn foll">follow</span>
                             <span class="btn foll">unfollow</span>*@
                        </td>
                    </tr>

                }
            </tbody>
        </table>
    </div>
</body>
</html>
